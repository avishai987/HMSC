---
title: '`r rstudioapi::getSourceEditorContext()$path %>% basename() %>% gsub(pattern = "\\.Rmd",replacement = "")`' 
author: "Avishai Wizel"
date: '`r Sys.time()`'
output:
  # html_notebook: 
  #   code_folding: hide
  #   toc: true
  #   toc_collapse: true
  #   toc_float:
  #     collapsed: false
  #   number_sections: true
  #   toc_depth: 1
  html_document: 
    code_folding: hide
    toc: yes
    toc_collapse: yes
    toc_float: 
      collapsed: TRUE
    number_sections: true
    toc_depth: 2
    df_print: paged
params: 
  data_out_dir: "./temp_data/" 
  input_data: !r c(
    hmsc_deg = "./Reports/HMSC/05_HPV_analysis/HMSC_hpv_deg_df.csv",
    opscc_deg = "./Reports/HPV_OPSCC_Analysis_PMC10191634/02_findDEG/OPSCC_HPV_DEG.csv",
    global_params  = "./Input_data/global_params.R")
---



# Functions

```{r warning=FALSE}
source_from_github(repositoy = "DEG_functions",version = "0.2.54")
source(params$input_data["global_params"])
```

# Data

```{r}
opscc_deg = read.table(file =  params$input_data["opscc_deg"],row.names = 1,sep = ",",header = T)
hmsc_deg = read.table(file =  params$input_data["hmsc_deg"],row.names = 1,sep = ",",header = T)

hmsc_top = hmsc_deg %>% filter(avg_log2FC > log2(signature_fc) &
                                 fdr < signature_fdr) %>% rownames()
opscc_top = opscc_deg %>% filter(avg_log2FC > log2(signature_fc) &
                                   fdr < signature_fdr) %>% rownames()

print ("intersect genes:")
intersected_genes = intersect(hmsc_top,opscc_top)
intersected_genes

```




```{r fig.height=7, fig.width=7}
plt = volcano_plot(
  de_genes = opscc_deg,
  fc_cutoff = volcano_fc,
  fdr_cutoff = volcano_fdr,
  ident1 = "HPV positive",
  ident2 = "HPV negative",
  top_genes_text = 0,
  show_gene_names = intersected_genes
  ) +
  ggtitle("Differential Gene Expression by HPV Status")  + 
  expand_limits(y = c(0, 4))+
  coord_cartesian(clip = "off")

plt
```

```{r}
pdf(paste0(params$data_out_dir,"OPSCC_HPVon_HPVoff_volcano.pdf"))
plt
dev.off()
```



